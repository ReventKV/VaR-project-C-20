# Проект расчета Value at Risk (VaR)

## Описание
Value at Risk (VaR) — стандартная метрика оценки финансовых рисков, показывающая максимальный потенциальный убыток портфеля за заданный период с определенной вероятностью.

## Реализованные методы
Проект реализует три основных метода расчета VaR:

1. **Параметрический метод (Variance-Covariance)**  
   Аналитический метод на основе нормального распределения доходностей и ковариационной матрицы.

2. **Метод Монте-Карло**  
   Стохастическое моделирование будущих цен активов с использованием геометрического броуновского движения и учета корреляций через разложение Холецкого.

3. **Исторический метод (Historical Simulation)**  
   Оценка риска на основе реальных исторических данных без предположений о распределении доходностей.

## Архитектура
Проект разделен на модли, каждый класс находится в пространстве имен `var`:

### 1. Data Layer
- **`DataLoader`**: Читает CSV-файлы, обрабатывает ошибки, преобразует сырые данные в структурированный формат
- **`TimeSeries`**: Хранит упорядоченную историю цен, обеспечивает быстрый доступ к данным
- **`CsvReader`**: Простой и надёжный парсер CSV-строк
- **`DataAlignment`**: Выполняет синхронизацию временных рядов с разными календарями

### 2. Math Kernel
- **`RiskModel`**: Строит ковариационную матрицу, выполняет выравнивание временных рядов по модели "forward-fill"
- **`ReturnCalculator`**: Вычисляет логарифмические доходности активов
- **`StatisticsCalculator`**: Выполняет статистические расчеты, включая поиск квантилей

### 3. Engines
- **`VaRCalculator`** (интерфейс): Базовый класс для всех методов расчета VaR
- **`ParametricVaRCalculator`**: Реализация параметрического метода
- **`MonteCarloVaRCalculator`**: Реализация метода Монте-Карло
- **`HistoricalVaRCalculator`**: Реализация исторического метода
- **`MonteCarloEngine`**: Параллельный генератор сценариев (GBM + Cholesky decomposition)
- **`MCStatistics`**: Агрегатор результатов и быстрый поиск VaR

### 4. Portfolio Domain
- **`Instrument`**: Базовый класс финансового инструмента, хранит ID и текущую рыночную цену
- **`Position`**: Связывает инструмент с его количеством, использует `std::shared_ptr<Instrument>`
- **`Portfolio`**: Агрегатор позиций, предоставляет методы для расчета суммарной стоимости

### 5. Вспомогательные классы
- **`ValuationFunction`**: Стратегия оценки стоимости инструмента в конкретном сценарии
- **`PriceRecord`**: Структура для хранения даты и цены
- **`RiskReport`**: Формирует отчеты о расчетах риска


## Технологический стек

### Основные технологии
- **Язык программирования**: C++20 (Concepts, Smart Pointers, многопоточность через std::async)
- **Система сборки**: CMake 3.14+
- **Математическая библиотека**: Eigen 3 для линейной алгебры
- **Тестирование**: GoogleTest framework
- **Документация**: Doxygen-ready комментарии в коде

### Ключевые особенности реализации
- Многопоточные вычисления для метода Монте-Карло
- Автоматическое выравнивание исторических данных с разными календарями
- Использование оптимизированных алгоритмов (nth_element для поиска квантилей)
- Детерминированная генерация случайных чисел для воспроизводимости результатов
- Устойчивый парсинг CSV-файлов с обработкой ошибок


## Сборка и запуск

### Сборка проекта
```bash
git clone <repository_url>
cd VaRProject
mkdir build && cd build
cmake ..
cmake --build .
```

### Запуск тестов
```bash
./tests/var_tests
```

### Запуск приложения
```bash
./src/var_app
```

## Использование
Приложение предлагает два режима работы:

1. **Demo Mode**: Автоматическая генерация тестовых данных и расчет VaR для демо-портфеля (акции Apple и Tesla).
2. **Custom Mode**: Загрузка пользовательских CSV-файлов с историческими данными.

### Формат CSV-файлов
- Формат данных: Дата (любой строковый формат), Цена (число)
- Пример:
  ```
  Date,Close
  2023-01-01,16500.50
  2023-01-02,16600.10
  ```

## Пример результата
```
=== Отчет по рискам портфеля ===
Позиций: 2
Общая стоимость: 2900.00 USD
Уровень доверия: 95%
Горизонт: 1 день
-----------------------------
Параметрический VaR: 116.58 USD (4.02%)
Метод Монте-Карло: 115.68 USD (3.99%)
Исторический VaR: 118.42 USD (4.08%)
```

## Интерпретация результатов
С вероятностью 95% убыток портфеля за один день не превысит указанные значения. Сравнение результатов трех методов позволяет оценить устойчивость оценки риска и выявить потенциальные расхождения между разными подходами.

## Дальнейшее развитие
- Реализация других метрик риска актива
- Усложнение приведённых моделей
- Добавление парсера с существующих бирж

